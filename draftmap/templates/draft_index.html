<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Map</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>

<h1>Welcome to the Draft Map Page!</h1>

<!-- Map Selector Buttons -->
<button id="map1Button">Stormpoint</button>
<button id="map2Button">World's Edge</button>
<button id="map3Button">Edistrict</button>

<!-- POI Selection Dropdown -->
<select id="poiList"></select>

<!-- Team Name Field -->
<input type="text" id="teamName" placeholder="Enter Team Name">

<!-- Buttons for POI Actions -->
<button id="pickButton">Pick POI</button>
<button id="removeButton">Remove POI</button>
<button id="toggleLoggingButton">Toggle Logging</button>
<button id="resetButton">Reset POIs</button>

<!-- POI Draft Table -->
<table id="poiTable">
    <thead>
        <tr>
            <th>POI</th>
            <th>Team</th>
            <th>Order</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Map Image -->
<div>
    <img id="mapImage" src="" alt="Current Map" style="width: 100%; max-height: 500px;">
</div>

<script type="text/javascript">
    const currentMap = "{{ current_map }}";  // Injected by Flask
    const poiListJson = '{{ poi_list | tojson | safe }}';  // Injected by Flask as JSON

    const poiList = JSON.parse(poiListJson);
    let loggingEnabled = false;
    let orderCount = 1;

    // Elements
    const poiDropdown = document.getElementById("poiList");
    const poiTableBody = document.getElementById("poiTable").getElementsByTagName('tbody')[0];
    const mapImage = document.getElementById("mapImage");

    // Function to update map image based on selected map
    function updateMapImage() {
        switch (currentMap) {
            case "stormpoint":
                mapImage.src = "/static/stormpoint.png";
                break;
            case "worldsedge":
                mapImage.src = "/static/worldsedge.png";
                break;
            case "edistrict":
                mapImage.src = "/static/edistrict.png";
                break;
            default:
                mapImage.src = "/static/stormpoint.png";  // Default to Stormpoint if no map selected
        }
    }

    // Populate the POI dropdown list
    function populatePOIList() {
        poiDropdown.innerHTML = '<option value="" disabled selected>Select POI</option>';
        poiList.forEach((poi, index) => {
            const option = document.createElement("option");
            option.value = index + 1;
            option.text = poi;
            poiDropdown.appendChild(option);
        });
    }

    // Switch map views
    function switchMap(mapId) {
        currentMap = mapId;
        populatePOIList();
        updateMapImage();
    }

    // Initialize the map and POI list
    populatePOIList();
    updateMapImage();  // Set the default map image on page load

    // Switch map on button click
    document.getElementById("map1Button").addEventListener("click", () => switchMap("stormpoint"));
    document.getElementById("map2Button").addEventListener("click", () => switchMap("worldsedge"));
    document.getElementById("map3Button").addEventListener("click", () => switchMap("edistrict"));
</script>

<script src="/static/script.js"></script>
</body>
</html>
