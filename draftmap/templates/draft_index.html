<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Map</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>

<h1>Welcome to the Draft Map Page!</h1>

<!-- Map Selector -->
<button id="map1Button">Stormpoint</button>
<button id="map2Button">World's Edge</button>
<button id="map3Button">Edistrict</button>

<!-- POI Selection Dropdown -->
<select id="poiList"></select>

<!-- Team Name Field -->
<input type="text" id="teamName" placeholder="Enter Team Name">

<!-- Buttons for POI Actions -->
<button id="pickButton">Pick POI</button>
<button id="removeButton">Remove POI</button>
<button id="toggleLoggingButton">Toggle Logging</button>
<button id="resetButton">Reset POIs</button>

<!-- POI Draft Table -->
<table id="poiTable">
    <thead>
        <tr>
            <th>POI</th>
            <th>Team</th>
            <th>Order</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script type="text/javascript">
    const currentMap = "{{ current_map }}";  // Injected by Flask
    const poiListJson = '{{ poi_list | tojson | safe }}';  // Injected by Flask as JSON

    const poiList = JSON.parse(poiListJson);
    let loggingEnabled = false;
    let orderCount = 1;

    // Elements
    const poiDropdown = document.getElementById("poiList");
    const poiTableBody = document.getElementById("poiTable").getElementsByTagName('tbody')[0];

    // Populate the POI dropdown list
    function populatePOIList() {
        poiDropdown.innerHTML = '<option value="" disabled selected>Select POI</option>';
        poiList.forEach((poi, index) => {
            const option = document.createElement("option");
            option.value = index + 1;
            option.text = poi;
            poiDropdown.appendChild(option);
        });
    }

    // Switch map views
    function switchMap(mapId) {
        currentMap = mapId;
        populatePOIList();
    }

    // Toggle logging
    function toggleLogging() {
        loggingEnabled = !loggingEnabled;
        alert(loggingEnabled ? "Logging enabled" : "Logging disabled");
    }

    // Pick a POI and add it to the draft table
    function pickPOI() {
        const teamName = document.getElementById("teamName").value;
        const poiNumber = poiDropdown.value;
        if (!poiNumber || !teamName) {
            alert("Please enter a team name and select a POI.");
            return;
        }

        const newRow = poiTableBody.insertRow();
        newRow.insertCell(0).innerText = poiDropdown.options[poiNumber - 1].text;
        newRow.insertCell(1).innerText = teamName;
        newRow.insertCell(2).innerText = orderCount++;
    }

    // Remove a POI from the draft table
    function removePOI() {
        const poiNumber = poiDropdown.value;
        if (!poiNumber) {
            alert("Please select a POI to remove.");
            return;
        }

        for (let row of poiTableBody.rows) {
            if (row.cells[0].innerText.includes(poiDropdown.options[poiNumber - 1].text)) {
                row.remove();
                break;
            }
        }
    }

    // Reset POIs and team selections
    function resetPOIState() {
        if (confirm("Are you sure you want to reset everything?")) {
            poiTableBody.innerHTML = '';  // Clear table
            orderCount = 1;
            populatePOIList();
        }
    }

    // Initialize the map and POI list
    populatePOIList();
</script>

<script src="/static/script.js"></script>
</body>
</html>
